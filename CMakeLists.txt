# Copyright (C) 2017-2018 LAAS-CNRS
#
# Author: Olivier Stasse
#
# See LICENSE 
cmake_minimum_required(VERSION 2.8.3)

set(CXX_DISABLE_WERROR True)

set(WARNING_CXX_FLAGS "${WARNING_CXX_FLAGS} -Werror=format-security")

include(cmake/base.cmake)
include(cmake/ros.cmake)
include(cmake/GNUInstallDirs.cmake)
include(cmake/python.cmake)

project(pyrene_integration_tests)

find_package(PkgConfig REQUIRED)


#set(bullet_FOUND 0)
#pkg_check_modules(bullet REQUIRED bullet)

## Find catkin macros and libraries
## if COMPONENTS list like find_package(catkin REQUIRED COMPONENTS xyz)
## is used, also find other catkin packages
find_package(catkin REQUIRED COMPONENTS
  controller_interface
  pal_hardware_interfaces  
  roscpp
  rospy
  std_msgs
  dynamic_graph_bridge
  control_msgs
  sensor_msgs
  realtime_tools
  roscontrol_sot
  talos_gazebo
)

## LAAS cmake submodule part
set(PROJECT_DESCRIPTION "Integration of the Stack of Tasks in roscontrol")
set(PROJECT_NAME pyrene_integration_tests)
set(PROJECT_URL "https://gepgitlab.laas.fr/pyrene-dev/pyrene_integration_tests")


include_directories(include ${bullet_INCLUDE_DIRS} ${catkin_INCLUDE_DIRS})

link_directories(${bullet_LIBRARY_DIRS})

SETUP_PROJECT()

set(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
set(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
set(CMAKE_INSTALL_RPATH "${LIBRARY_OUTPUT_PATH}")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY "${LIBRARY_OUTPUT_PATH}")

# This is necessary so that the pc file generated by catking is similar to the one
# done directly by jrl-cmake-modules
catkin_package(CATKIN_DEPENDS
roscpp realtime_tools message_runtime dynamic_graph_bridge pal_hardware_interfaces controller_interface
LIBRARIES rcsot_controller)



###########
## Build ##
###########

## Specify additional locations of header files
## Your package locations should be listed before other locations
# include_directories(include)
include_directories( 
  ${catkin_INCLUDE_DIRS}
  )

## Declare a C++ library
#add_library()

## Add cmake target dependencies of the executable
## same as for the library above
# add_dependencies(roscontrol_sot_node ${${PROJECT_NAME}_EXPORTED_TARGETS} ${catkin_EXPORTED_TARGETS})

## Specify libraries to link a library or executable target against
#target_link_libraries(rcsot_controller
#  ${catkin_LIBRARIES}
#  ${bullet_LIBRARIES}
#  )

#pkg_config_use_dependency(rcsot_controller urdfdom)

## Mark executables and/or libraries for installation
#install(TARGETS tests DESTINATION tests )

#ADD_EXECUTABLE(roscontrol-sot-parse-log
#  src/roscontrol-sot-parse-log.cc)
#install(TARGETS roscontrol-sot-parse-log DESTINATION bin )

foreach(dir launch tests)
  install(DIRECTORY ${dir}
    DESTINATION ${CATKIN_PACKAGE_SHARE_DESTINATION}
  )
endforeach()

SETUP_PROJECT_FINALIZE()

catkin_add_nosetests(scripts/test_kine.py)

if(CATKIN_ENABLE_TESTING)
  find_package(rostest REQUIRED)
  add_rostest(tests/test_kine.test)
endif()
